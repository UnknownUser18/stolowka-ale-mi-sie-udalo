<section>
  <search>
    @let searchInput_title = 'Wyszukaj osobę z ZSTI...';
    <input type="search" name="searchSimple" [placeholder]="searchInput_title" [(ngModel)]="search" [title]="searchInput_title" [attr.aria-label]="searchInput_title" (keydown.enter)="filterZPersons()" />
    <button (click)="filterZPersons()">
      @let search_title = 'Wyszukaj osobę';
      <fa-icon [icon]="faMagnifyingGlass" [title]="search_title" [attr.aria-label]="search_title" />
    </button>
  </search>

  <button class="filter-button">
    Filtruj
    @let filter_title = 'Otwórz menu filtrów';
    <fa-icon [icon]="faFilter" [title]="filter_title" [attr.aria-label]="filter_title" />
  </button>

  @if (shownZPersons === undefined) {
    <p>Ładowanie osób...</p>
  } @else if (shownZPersons === null) {
    <p><fa-icon [icon]="faWarning" /> Wystąpił błąd podczas ładowania.</p>
  } @else {
    <p>Znaleziono {{ shownZPersons.length }} {{ osobString(shownZPersons.length) }}</p>
  }

  <button class="sort-button">
    Sortuj
    @let sort_title = 'Sortuj osoby';
    <fa-icon [icon]="faArrowUpWideShort" [title]="sort_title" [attr.aria-label]="sort_title" />
  </button>

  <button class="refresh-button" (click)="requestPersons()">
    Odśwież
    @let refresh_title = 'Odśwież listę osób';
    <fa-icon [icon]="faArrowsRotate" [title]="refresh_title" [attr.aria-label]="refresh_title" [class.spin]="isRefreshing()" />
  </button>

  <button class="add-button">
    Dodaj osobę
    @let add_title = 'Dodaj nową osobę do stołówki';
    <fa-icon [icon]="faPlus" [title]="add_title" [attr.aria-label]="add_title" />
    <!-- This will redirect to another route (DO NOT MAKE A VIEW ON THIS COMPONENT)   -->
  </button>
</section>
<table>
  <thead>
  <tr>
    <th>#</th>
    <th>Nazwisko & imię</th>
    <th>Klasa</th>
    <th>Może uczęszczać</th>
    <th>Opłacany przez miasto</th>
  </tr>
  </thead>
  <div class="table-body-scroll">
    <tbody>
      @defer (when shownZPersons !== undefined && shownZPersons !== null) {
        @for (person of shownZPersons; track person.id; let index = $index) {
          <tr>
            <td>{{ index + 1 }}</td>
            @let full_name = `${ person.nazwisko } ${ person.imie }`;
            @let button_title = `Wybierz osobę ${ full_name }`;
            <td>
              <button [title]="button_title" [attr.aria-label]="button_title">{{ full_name }}</button>
            </td>
            <td>{{ isTeacher(person) ? 'Nauczyciel' : person.klasa }}</td>
            <td>
              <span [class]="{ 'yes': person.uczeszcza, 'no': !person.uczeszcza }">
              <fa-icon [icon]="faCircle" [size]="'2xs'" />
                {{ person.uczeszcza ? 'Tak' : 'Nie' }}
              </span>
            </td>
            <td>
              <span [class]="{ 'yes': person.miasto, 'no': !person.miasto }">
              <fa-icon [icon]="faCircle" [size]="'2xs'" />
                {{ person.miasto ? 'Tak' : 'Nie' }}
              </span>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="5">Brak osób do wyświetlenia</td>
          </tr>
        }
      } @placeholder (minimum 1000ms) {
        @for (i of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; track i) {
          <tr class="placeholder-row">
            @for (j of [1, 2, 3, 4, 5]; track j) {
              <td></td>
            }
          </tr>
        }
      }
    </tbody>
  </div>
</table>

<dialog autofocus #filterDialog>
  blah
</dialog>
