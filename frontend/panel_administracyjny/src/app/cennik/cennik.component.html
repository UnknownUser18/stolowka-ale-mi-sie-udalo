<section>
  <h2>Lista dostępnych cenników:</h2>
  <button class="add-button" (click)="openWindow('add')">
    Dodaj cennik
    @let add_title = 'Dodaj nowy cennik';
    <fa-icon [icon]="faPlus" [title]="add_title" [attr.aria-label]="add_title" />
  </button>

  <button class="refresh-button" (click)="reloadPricing()">
    Odśwież
    @let refresh_title = 'Odśwież cenniki';
    <fa-icon [icon]="faArrowsRotate" [title]="refresh_title" [attr.aria-label]="refresh_title" />
  </button>
</section>
  <table>
    <thead>
    <tr>
      <th>Numer</th>
      <th>Cena</th>
      <th>Data rozpoczęcia</th>
      <th>Data zakończenia</th>
      <th></th>
    </tr>
    </thead>
    <tbody>
      @defer (when pricing_zsti) {
      @for (price of pricing_zsti; track price.id; let i = $index) {
        <tr>
          <td>{{ i + 1 }}</td>
          <td>{{ price.cena | currency : 'PLN' }}</td>
          <td>{{ price.data_od | date : 'longDate' }}</td>
          <td>{{ price.data_do ? (price.data_do | date : 'longDate') : 'Brak daty końcowej' }}</td>
          <td>
            <button (click)="selectPricing(price)">Wybierz</button>
          </td>
        </tr>
      } @empty {
        <tr>
          <td class="empty">Brak dostępnych cenników...</td>
        </tr>
      } } @placeholder (minimum 500ms) {
      @for (day of [0, 1, 2, 3, 4, 5, 6, 7, 6, 7, 6, 7, 8, 9, 10]; track day) {
        <tr class="placeholder-row">
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      }
    }
    </tbody>
  </table>
@if (id) {
<form [formGroup]="pricingForm" class="selected">
    <label>
      <span>Cena : </span>
      <input type="number" formControlName="cena">
    </label>
    <label>
      <span>Data Rozpoczęcia : </span>
      <input type="date" formControlName="data_od">
    </label>
    <label>
      <span>Data Zakończenia : </span>
      <input type="date" formControlName="data_do">
    </label>
    <button type="submit" (click)="updatePricing()">Prześlij dane</button>
    <button type="button" (click)="openWindow('delete')">Usuń deklaracje</button>
</form>
}
<!--<button (click)="openWindow('add')">Dodaj deklarację</button>-->
@if (showWindow !== '') {
  <section #filter [class]="{'delete': showWindow === 'delete','add': showWindow === 'add'}" class="window">
    <div>
      <fa-icon [icon]="xmarkClose" (click)="closeWindow()" class="close"></fa-icon>
<!--      <i class="fa-solid fa-xmark close" ></i>-->
      @if (showWindow === 'delete') {
        <h3>Ostrzeżenie</h3>
        <p>Czy na pewno chcesz usunąć cennik od dnia <b>{{ formatDate(pricingForm.get('data_od')?.value!) }}</b> do dnia <b>{{ formatDate(pricingForm.get('data_do')?.value!) }}</b>?</p>
        <button type="button" (click)="deletePricing()">Usuń</button>
        <button type="button" (click)="closeWindow()">Anuluj</button>
      } @else if (showWindow === 'add') {
        <h3>Dodaj Cennik</h3>
        <form [formGroup]="addForm">
          <fieldset>
            <legend><i class="fa-solid fa-money-bill"></i> Cena:</legend>
            <label>
              <span>Cena:</span>
              <input type="number" formControlName="cena">
            </label>
          </fieldset>
          <fieldset>
            <legend><i class="fa-solid fa-calendar"></i> Daty:</legend>
            <label>
              <span>Data rozpoczęcia:</span>
              <input type="date" formControlName="data_od">
            </label>
            <label>
              <span>Data zakończenia:</span>
              <input type="date" formControlName="data_do">
            </label>
          </fieldset>
          <button type="button" (click)="addPricing()">Dodaj</button>
        </form>
      }
    </div>
  </section>
}
